(()=>{var e={};e.id=525,e.ids=[525],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},7181:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>d,routeModule:()=>p,tree:()=>c}),t(270),t(2029),t(5866);var a=t(3191),n=t(8716),r=t(7922),i=t.n(r),l=t(5231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);t.d(s,o);let c=["",{children:["inference",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,270)),"/Users/adam/Projects/Inzynierka/codebase/src/frontend/src/app/inference/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,2029)),"/Users/adam/Projects/Inzynierka/codebase/src/frontend/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,5866,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/adam/Projects/Inzynierka/codebase/src/frontend/src/app/inference/page.tsx"],x="/inference/page",m={require:t,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/inference/page",pathname:"/inference",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},9499:(e,s,t)=>{Promise.resolve().then(t.t.bind(t,2994,23)),Promise.resolve().then(t.t.bind(t,6114,23)),Promise.resolve().then(t.t.bind(t,9727,23)),Promise.resolve().then(t.t.bind(t,9671,23)),Promise.resolve().then(t.t.bind(t,1868,23)),Promise.resolve().then(t.t.bind(t,4759,23))},2800:(e,s,t)=>{Promise.resolve().then(t.t.bind(t,9404,23))},5449:(e,s,t)=>{Promise.resolve().then(t.bind(t,2618))},2618:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>j});var a=t(326),n=t(7577),r=t(8561),i=t(2872),l=t(6913),o=t(830),c=t(3871);function d({entry:e,onClose:s}){let t="completed"===(e.status||(e.outputs.length>0?"completed":"failed"));return a.jsx(o.u_,{title:`Run - ${new Date(e.timestamp).toLocaleString()}`,onClose:s,children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between pb-2 border-b border-slate-200",children:[a.jsx("h3",{className:"font-semibold text-slate-900",children:"Configuration"}),a.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${t?"bg-green-100 text-green-700 border border-green-300":"bg-red-100 text-red-700 border border-red-300"}`,children:t?"✓ Completed":"✗ Failed"})]}),a.jsx("div",{className:"space-y-2",children:(0,a.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,a.jsxs)("div",{children:[a.jsx("span",{className:"text-slate-600",children:"Model:"})," ",a.jsx("span",{className:"text-slate-900 font-mono",children:e.model_id})]}),(0,a.jsxs)("div",{children:[a.jsx("span",{className:"text-slate-600",children:"SAE:"})," ",a.jsx("span",{className:"text-slate-900 font-mono",children:e.sae_id})]}),(0,a.jsxs)("div",{children:[a.jsx("span",{className:"text-slate-600",children:"Layer:"})," ",a.jsx("span",{className:"text-slate-900 font-mono",children:e.layer})]}),(0,a.jsxs)("div",{children:[a.jsx("span",{className:"text-slate-600",children:"Top-K:"})," ",a.jsx("span",{className:"text-slate-900",children:e.settings.topK})]}),(0,a.jsxs)("div",{className:"mt-2",children:[a.jsx("span",{className:"text-slate-600",children:"Prompts:"}),a.jsx("div",{className:"mt-1 space-y-1",children:e.prompts.map((e,s)=>a.jsx("div",{className:"text-slate-900 bg-slate-50 border border-slate-200 p-2 rounded text-xs",children:e},s))})]}),(0,a.jsxs)("div",{className:"mt-2",children:[a.jsx("span",{className:"text-slate-600",children:"Settings:"}),(0,a.jsxs)("div",{className:"mt-1 text-slate-700 text-xs",children:["Save top texts: ",e.settings.saveTopTexts?"✓":"✗"," | Track texts:"," ",e.settings.trackTexts?"✓":"✗"," | Return token latents:"," ",e.settings.returnTokenLatents?"✓":"✗"]}),e.settings.conceptConfigPath&&(0,a.jsxs)("div",{className:"mt-1 text-slate-700 text-xs",children:["Concept config: ",a.jsx("span",{className:"font-mono",children:e.settings.conceptConfigPath})]})]})]})}),e.outputs.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("h3",{className:"font-semibold text-slate-900",children:"Outputs"}),a.jsx("div",{className:"space-y-2",children:e.outputs.map((e,s)=>(0,a.jsxs)("div",{className:"bg-slate-50 border border-slate-200 p-3 rounded text-xs",children:[(0,a.jsxs)("div",{className:"text-slate-600 mb-1 font-medium",children:["Prompt #",s+1]}),a.jsx("div",{className:"text-slate-900 whitespace-pre-wrap",children:e.text}),e.tokens&&e.tokens.length>0&&(0,a.jsxs)("div",{className:"text-slate-600 mt-1",children:["Tokens: ",e.tokens.join(" ")]})]},s))})]}),e.top_neurons.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("h3",{className:"font-semibold text-slate-900",children:"Top Neurons"}),a.jsx("div",{className:"space-y-2",children:e.top_neurons.map((e,s)=>(0,a.jsxs)("div",{className:"bg-slate-50 border border-slate-200 p-3 rounded text-xs",children:[(0,a.jsxs)("div",{className:"font-semibold text-slate-900",children:["Prompt #",e.prompt_index+1]}),(0,a.jsxs)("div",{className:"text-slate-700",children:["Neurons: ",e.neuron_ids.join(", ")]}),(0,a.jsxs)("div",{className:"text-slate-600 text-xs",children:["Activations: ",e.activations.map(e=>e.toFixed(3)).join(", ")]})]},s))})]}),e.token_latents.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("h3",{className:"font-semibold text-slate-900",children:"Token Latents"}),a.jsx("div",{className:"space-y-2",children:e.token_latents.map((e,s)=>(0,a.jsxs)("div",{className:"bg-slate-50 border border-slate-200 p-3 rounded text-xs",children:[(0,a.jsxs)("div",{className:"font-semibold text-slate-900",children:["Prompt #",e.prompt_index+1]}),a.jsx("div",{className:"space-y-1 mt-1",children:e.tokens.map((e,s)=>(0,a.jsxs)("div",{className:"text-slate-700",children:["Token ",e.token_index,": ",e.neuron_ids.join(", ")]},s))})]},s))})]}),e.top_texts_path&&(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("h3",{className:"font-semibold text-slate-900",children:"Top Texts"}),(0,a.jsxs)("div",{className:"text-slate-700 text-xs",children:["Saved at: ",a.jsx("span",{className:"text-amber-600 font-mono",children:e.top_texts_path})]})]}),e.error&&(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("h3",{className:"font-semibold text-slate-900",children:"Error"}),a.jsx("div",{className:"bg-red-50 border border-red-200 rounded p-2 text-red-700 text-xs",children:e.error})]})]})})}function x({history:e,onSelectHistory:s,selectedHistoryEntry:t,onCloseHistoryModal:r,settings:i,onSettingsChange:l}){let[o,c]=(0,n.useState)("history"),x=e=>new Date(e).toLocaleString();return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex gap-2 border-b border-slate-200 pb-2",children:[a.jsx("button",{onClick:()=>c("history"),className:`flex-1 px-3 py-1.5 text-sm rounded-md transition ${"history"===o?"bg-amber-100 text-amber-900 font-medium":"text-slate-600 hover:text-slate-900 hover:bg-slate-100"}`,children:"History"}),a.jsx("button",{onClick:()=>c("settings"),className:`flex-1 px-3 py-1.5 text-sm rounded-md transition ${"settings"===o?"bg-amber-100 text-amber-900 font-medium":"text-slate-600 hover:text-slate-900 hover:bg-slate-100"}`,children:"Settings"})]}),"history"===o&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"text-xs font-semibold uppercase tracking-wide text-amber-600 mb-2",children:["Past Runs (",e.length,")"]}),0===e.length?a.jsx("p",{className:"text-xs text-slate-600",children:"No history yet. Run some inferences to see them here."}):a.jsx("div",{className:"space-y-2 max-h-[60vh] overflow-y-auto",children:e.map(e=>{let t="completed"===(e.status||(e.outputs.length>0?"completed":"failed"));return(0,a.jsxs)("button",{onClick:()=>s(e),className:"w-full text-left p-2 rounded-md border border-slate-200 bg-white hover:bg-amber-50 hover:border-amber-300 transition text-xs",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsxs)("div",{className:"font-medium text-slate-900 truncate",children:[a.jsx("span",{className:"text-slate-600",children:"Model:"})," ",a.jsx("span",{className:"text-slate-900",children:e.model_id})," / ",a.jsx("span",{className:"text-slate-600",children:"SAE:"})," ",a.jsx("span",{className:"text-slate-900",children:e.sae_id})]}),a.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${t?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:t?"✓ Completed":"✗ Failed"})]}),a.jsx("div",{className:"text-slate-900 text-xs mt-1 font-mono font-semibold",children:e.id}),a.jsx("div",{className:"text-slate-700 text-xs mt-1",children:x(e.timestamp)}),(0,a.jsxs)("div",{className:"text-slate-700 text-xs mt-1",children:[e.prompts.length," prompt",1!==e.prompts.length?"s":""]})]},e.id)})})]}),"settings"===o&&(0,a.jsxs)("div",{className:"space-y-4",children:[a.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-amber-600 mb-2",children:"Options"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[a.jsx("input",{type:"checkbox",checked:i.loadConcepts,onChange:e=>l({...i,loadConcepts:e.target.checked}),className:"rounded border-slate-300 text-amber-600 focus:ring-amber-500"}),a.jsx("span",{className:"text-slate-700",children:"Load concepts"})]}),(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[a.jsx("input",{type:"checkbox",checked:i.saveTopTexts,onChange:e=>l({...i,saveTopTexts:e.target.checked}),className:"rounded border-slate-300 text-amber-600 focus:ring-amber-500"}),a.jsx("span",{className:"text-slate-700",children:"Save top texts"})]}),(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[a.jsx("input",{type:"checkbox",checked:i.trackTexts,onChange:e=>l({...i,trackTexts:e.target.checked}),className:"rounded border-slate-300 text-amber-600 focus:ring-amber-500"}),a.jsx("span",{className:"text-slate-700",children:"Track texts"})]})]})]})]}),t&&a.jsx(d,{entry:t,onClose:r})]})}function m({runNumber:e,timestamp:s,config:t,outputs:n,top_neurons:r,token_latents:i,top_texts_path:l,onDelete:c}){return(0,a.jsxs)(o.Zb,{className:"space-y-4 border-2 border-amber-200 bg-amber-50/50",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between border-b border-amber-200 pb-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"font-semibold text-slate-900",children:["Run #",e]}),a.jsx("div",{className:"text-xs text-slate-600",children:new Date(s).toLocaleString()})]}),c&&a.jsx(o.zx,{variant:"ghost",onClick:c,className:"text-slate-500 hover:text-red-600 hover:bg-red-50",title:"Delete this run",children:a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),a.jsx("div",{className:"space-y-2 text-sm",children:(0,a.jsxs)("div",{children:[a.jsx("span",{className:"font-medium text-slate-700",children:"Configuration:"}),(0,a.jsxs)("div",{className:"mt-1 space-y-1 text-xs text-slate-600",children:[(0,a.jsxs)("div",{children:["Model: ",a.jsx("span",{className:"font-mono",children:t.model_id})]}),(0,a.jsxs)("div",{children:["SAE: ",a.jsx("span",{className:"font-mono",children:t.sae_id})]}),(0,a.jsxs)("div",{children:["Layer: ",a.jsx("span",{className:"font-mono",children:t.layer})]}),(0,a.jsxs)("div",{children:["Top-K: ",a.jsx("span",{className:"font-mono",children:t.topK})]}),(0,a.jsxs)("div",{children:["Prompts: ",a.jsx("span",{className:"font-mono",children:t.prompts.length})]}),(0,a.jsxs)("div",{className:"flex gap-4 mt-1",children:[(0,a.jsxs)("span",{children:["Save top texts: ",t.saveTopTexts?"✓":"✗"]}),(0,a.jsxs)("span",{children:["Track texts: ",t.trackTexts?"✓":"✗"]}),(0,a.jsxs)("span",{children:["Token latents: ",t.returnTokenLatents?"✓":"✗"]})]}),t.conceptConfigPath&&(0,a.jsxs)("div",{children:["Concept config: ",a.jsx("span",{className:"font-mono text-xs",children:t.conceptConfigPath})]})]})]})}),n.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(o.NZ,{children:"Outputs"}),n.map((e,s)=>(0,a.jsxs)(o.Zb,{className:"space-y-2 bg-white",children:[(0,a.jsxs)("div",{className:"text-xs text-slate-600",children:["Prompt #",s+1]}),a.jsx("div",{className:"text-slate-900 whitespace-pre-wrap",children:e.text}),e.tokens&&e.tokens.length>0&&(0,a.jsxs)("div",{className:"text-xs text-slate-600",children:["Tokens: ",e.tokens.join(" ")]})]},s))]}),r.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(o.NZ,{children:"Top Neurons"}),a.jsx(o.Zb,{className:"space-y-2 text-sm bg-white",children:r.map((e,s)=>(0,a.jsxs)("div",{className:"border border-slate-200 rounded-md p-2",children:[(0,a.jsxs)("div",{className:"font-semibold text-slate-900",children:["Prompt #",e.prompt_index+1]}),(0,a.jsxs)("div",{className:"text-slate-700",children:["Neurons: ",e.neuron_ids.join(", ")]}),(0,a.jsxs)("div",{className:"text-slate-600 text-xs",children:["Activations: ",e.activations.map(e=>e.toFixed(3)).join(", ")]})]},s))})]}),i.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(o.NZ,{children:"Token Latents"}),a.jsx(o.Zb,{className:"space-y-3 text-sm bg-white",children:i.map((e,s)=>(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"font-semibold text-slate-900",children:["Prompt #",e.prompt_index+1]}),e.tokens.map((e,s)=>(0,a.jsxs)("div",{className:"text-slate-700 text-xs",children:["Token ",e.token_index,": ",e.neuron_ids.join(", ")]},s))]},s))})]}),l&&a.jsx(o.Zb,{className:"bg-white",children:(0,a.jsxs)("div",{className:"text-sm text-slate-700",children:["Top texts saved at:"," ",a.jsx("a",{href:l,className:"text-amber-600 hover:underline",children:l})]})})]})}function p({modelId:e,saeId:s,onEditsChange:t,onBiasChange:r,onPreview:i,onSaveConfig:l}){let[c,d]=(0,n.useState)([]),[x,m]=(0,n.useState)(new Set),[p,h]=(0,n.useState)({}),[u,j]=(0,n.useState)(!1),[f,b]=(0,n.useState)(null),g=e=>{let s=new Set(x);if(s.has(e)){s.delete(e);let t={...p};delete t[e],h(t)}else s.add(e),p[e]||h({...p,[e]:1});m(s),N(s,p)},v=(e,s)=>{let t={...p,[e]:s};h(t),N(x,t)},N=(e,s)=>{let a={},n={};e.forEach(e=>{let t=s[e]??1;a[e.toString()]=t,n[e.toString()]=0}),t(a),r(n)};return e&&s?u?a.jsx(o.Zb,{className:"p-4 bg-slate-50",children:a.jsx("div",{className:"text-sm text-slate-600",children:"Loading concepts..."})}):f?a.jsx(o.Zb,{className:"p-4 bg-red-50 border-red-200",children:a.jsx("div",{className:"text-sm text-red-600",children:f})}):(0,a.jsxs)(o.Zb,{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx(o.__,{children:"Select Concepts to Manipulate"}),a.jsx("div",{className:"mt-2 max-h-64 overflow-y-auto border border-slate-200 rounded-md p-2 space-y-1",children:0===c.length?a.jsx("div",{className:"text-xs text-slate-600",children:"No concepts found in dictionary."}):c.map(e=>a.jsx("button",{type:"button",onClick:()=>g(e.neuron_index),className:`w-full text-left px-3 py-2 rounded-md text-sm transition ${x.has(e.neuron_index)?"bg-amber-100 border-2 border-amber-400 text-amber-900":"bg-white border border-slate-200 hover:bg-slate-50 text-slate-700"}`,children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[a.jsx("div",{className:"font-medium",children:e.name}),(0,a.jsxs)("div",{className:"text-xs text-slate-600",children:["Neuron ",e.neuron_index," (score: ",e.score.toFixed(3),")"]})]}),x.has(e.neuron_index)&&a.jsx("div",{className:"text-amber-600",children:"✓"})]})},e.neuron_index))})]}),x.size>0&&(0,a.jsxs)("div",{className:"space-y-3",children:[a.jsx(o.__,{children:"Adjust Weights for Selected Concepts"}),Array.from(x).sort().map(e=>{let s=c.find(s=>s.neuron_index===e);return(0,a.jsxs)("div",{className:"space-y-2 p-3 bg-amber-50 rounded-md border border-amber-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[a.jsx("div",{className:"font-medium text-sm text-slate-900",children:s?.name||`Neuron ${e}`}),(0,a.jsxs)("div",{className:"text-xs text-slate-600",children:["Neuron ",e]})]}),a.jsx("div",{className:"text-sm font-mono text-slate-700",children:p[e]?.toFixed(2)??"1.00"})]}),a.jsx("input",{type:"range",min:-2,max:2,step:.1,value:p[e]??1,onChange:s=>v(e,Number(s.target.value)),className:"w-full"})]},e)})]}),x.size>0&&(0,a.jsxs)("div",{className:"flex gap-2 pt-2",children:[a.jsx(o.zx,{variant:"primary",onClick:i,children:"Preview"}),a.jsx(o.zx,{variant:"ghost",onClick:l,children:"Save Config"})]})]}):a.jsx(o.Zb,{className:"p-4 bg-slate-50",children:a.jsx("div",{className:"text-sm text-slate-600",children:"Select a model and SAE to load concepts."})})}function h({prompts:e,setPrompts:s,disabled:t,onRun:n,isRunning:r}){return(0,a.jsxs)("div",{className:t?"opacity-50 pointer-events-none space-y-4":"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(o.__,{children:"Prompts"}),e.map((t,n)=>(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx(o.Kx,{value:t.prompt,onChange:t=>{let a=[...e];a[n]={prompt:t.target.value},s(a)}}),a.jsx(o.zx,{variant:"ghost",onClick:()=>s(e.filter((e,s)=>s!==n)),disabled:1===e.length,children:"Remove"})]},n)),a.jsx(o.zx,{variant:"ghost",onClick:()=>s([...e,{prompt:""}]),children:"Add prompt"})]}),a.jsx(o.zx,{onClick:n,disabled:t||r,children:r?"Running inference...":"Run inference"})]})}function u({saeId:e,setSaeId:s,layer:t,topK:n,setTopK:r,saveTopTexts:i,setSaveTopTexts:l,trackTexts:c,setTrackTexts:d,returnTokenLatents:x,setReturnTokenLatents:m,conceptConfigPath:p,setConceptConfigPath:h,loadConcepts:u,saes:j,currentSae:f,disabled:b}){return(0,a.jsxs)("div",{className:b?"opacity-50 pointer-events-none space-y-4":"space-y-4",children:[(0,a.jsxs)(o.X2,{children:[(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx(o.__,{children:"SAE"}),a.jsx("select",{className:"input",value:e,onChange:e=>s(e.target.value),disabled:b,children:j?.saes?.map(e=>a.jsx("option",{value:e.sae_id,children:e.sae_id},e.sae_id))})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx(o.__,{children:"Layer"}),a.jsx(o.II,{value:t,disabled:!0,readOnly:!0,className:"bg-slate-50 cursor-not-allowed"}),!f?.layer&&a.jsx("p",{className:"text-xs text-slate-500",children:"Layer will be set from selected SAE"})]})]}),(0,a.jsxs)(o.X2,{children:[(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx(o.__,{children:"Top-K neurons"}),a.jsx(o.II,{type:"number",value:n,onChange:e=>r(Number(e.target.value)),min:1})]}),u&&(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx(o.__,{children:"Concept config path (optional)"}),a.jsx(o.II,{value:p,onChange:e=>h(e.target.value)})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(o.__,{children:"Options"}),(0,a.jsxs)("div",{className:"flex gap-4 text-sm",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"checkbox",checked:i,onChange:e=>l(e.target.checked),className:"rounded border-slate-300 text-amber-600 focus:ring-amber-500"}),"Save top texts"]}),(0,a.jsxs)("label",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"checkbox",checked:c,onChange:e=>d(e.target.checked),className:"rounded border-slate-300 text-amber-600 focus:ring-amber-500"}),"Track texts"]}),(0,a.jsxs)("label",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"checkbox",checked:x,onChange:e=>m(e.target.checked),className:"rounded border-slate-300 text-amber-600 focus:ring-amber-500"}),"Return token latents"]})]})]})]})}function j(){let{models:e,modelId:s,setModelId:t,modelLoaded:d,setModelLoaded:j,loadModel:f,isLoading:b}=(0,l.B)(),{data:g}=(0,r.ZP)(s?`/sae/saes?model_id=${s}`:null,()=>i.h.listSaes(s)),[v,N]=(0,n.useState)(""),[y,_]=(0,n.useState)(!1),[w,S]=(0,n.useState)([]),[k,C]=(0,n.useState)(1),P=function(e,s){let[t,a]=(0,n.useState)(""),[r,i]=(0,n.useState)(""),[l,o]=(0,n.useState)([{prompt:"Hello world"}]),[c,d]=(0,n.useState)(5),[x,m]=(0,n.useState)(!1),[p,h]=(0,n.useState)(!1),[u,j]=(0,n.useState)(!1),[f,b]=(0,n.useState)(""),[g,v]=(0,n.useState)(!1);(0,n.useMemo)(()=>{e?.saes?.length&&!t&&a(e.saes[0].sae_id)},[e,t]);let N=(0,n.useMemo)(()=>e?.saes?.find(e=>e.sae_id===t),[e,t]);return(0,n.useMemo)(()=>{N?.layer?i(N.layer):i("")},[N]),{saeId:t,layer:r,prompts:l,topK:c,saveTopTexts:x,trackTexts:p,returnTokenLatents:u,conceptConfigPath:f,loadConcepts:g,setSaeId:a,setLayer:i,setPrompts:o,setTopK:d,setSaveTopTexts:m,setTrackTexts:h,setReturnTokenLatents:j,setConceptConfigPath:b,setLoadConcepts:v}}(g),{history:T,selectedHistoryEntry:$,setSelectedHistoryEntry:E,saveToHistory:O,clearHistory:A}=function(){let[e,s]=(0,n.useState)([]),[t,a]=(0,n.useState)(null);return{history:e,selectedHistoryEntry:t,setSelectedHistoryEntry:a,saveToHistory:t=>{s([t,...e].slice(0,100))},clearHistory:()=>{s([])}}}(),L=function(){let[e,s]=(0,n.useState)({}),[t,a]=(0,n.useState)({}),[r,l]=(0,n.useState)(""),[o,c]=(0,n.useState)(""),d=async(s,a)=>{try{let n=await i.h.previewConcept({model_id:s,sae_id:a,edits:e,bias:t});l(JSON.stringify(n,null,2))}catch(s){let e=s instanceof Error?s.message:"Unknown error";l(`Error: ${e}`)}},x=async(s,a,n)=>{try{let r=await i.h.manipulateConcept({model_id:s,sae_id:a,edits:e,bias:t});return c(`Saved config at ${r.concept_config_path}`),n&&n(r.concept_config_path),r.concept_config_path}catch(s){let e=s instanceof Error?s.message:"Unknown error";return c(`Error: ${e}`),null}};return{conceptEdits:e,conceptBias:t,conceptPreview:r,conceptSaveResult:o,setConceptEdits:s,setConceptBias:a,previewConcept:d,saveConceptConfig:x,clearConceptManipulation:()=>{s({}),a({}),l(""),c("")}}}(),{saeId:I,setSaeId:Z,layer:M,prompts:z,setPrompts:R,topK:U,setTopK:q,saveTopTexts:D,setSaveTopTexts:F,trackTexts:H,setTrackTexts:J,returnTokenLatents:B,setReturnTokenLatents:K,conceptConfigPath:X,setConceptConfigPath:G,loadConcepts:V,setLoadConcepts:W}=P,{conceptEdits:Q,setConceptEdits:Y,conceptBias:ee,setConceptBias:es,conceptPreview:et,conceptSaveResult:ea,previewConcept:en,saveConceptConfig:er,clearConceptManipulation:ei}=L,{data:el,mutate:eo}=(0,r.ZP)(s&&d&&I?`/sae/concepts/configs?model_id=${s}&sae_id=${I}`:null,()=>i.h.listConceptConfigs(s,I)),ec=(0,n.useMemo)(()=>g?.saes?.find(e=>e.sae_id===I),[g,I]),ed=async()=>{if(s){N("Loading model...");try{await f(),N("Model loaded")}catch(s){let e=s instanceof Error?s.message:String(s);N(`Error loading model: ${e}`),j(!1)}}},ex=async()=>{if(s&&I&&d){_(!0),N("Running inference...");try{let e=g?.saes?.find(e=>e.sae_id===I);if(!e)throw Error(`SAE ${I} not found in available SAEs`);if(!e.sae_path)throw Error(`SAE ${I} is missing sae_path. The SAE file may not exist.`);let t={model_id:s,sae_id:I,sae_path:e.sae_path,layer:M,inputs:z.map(e=>({prompt:e.prompt})),top_k_neurons:U,save_top_texts:D,track_texts:H,return_token_latents:B,concept_config_path:X||void 0},a=await i.h.infer(t),n=`run-${Date.now()}-${k}`,r=new Date().toISOString(),l={id:n,timestamp:r,config:{model_id:s,sae_id:I,layer:M,prompts:z.map(e=>e.prompt),topK:U,saveTopTexts:D,trackTexts:H,returnTokenLatents:B,conceptConfigPath:X||void 0},outputs:a.outputs||[],top_neurons:a.top_neurons||[],token_latents:a.token_latents||[],top_texts_path:a.top_texts_path};S([l,...w]),C(k+1);let o={id:n,timestamp:r,model_id:s,sae_id:I,layer:M,prompts:z.map(e=>e.prompt),outputs:a.outputs||[],top_neurons:a.top_neurons||[],token_latents:a.token_latents||[],top_texts_path:a.top_texts_path,status:"completed",settings:{saveTopTexts:D,trackTexts:H,returnTokenLatents:B,conceptConfigPath:X||void 0,topK:U}};O(o),N("Done")}catch(t){let e=t instanceof Error?t.message:String(t);N(`Error: ${e}`),O({id:`run-${Date.now()}-${k}`,timestamp:new Date().toISOString(),model_id:s,sae_id:I,layer:M,prompts:z.map(e=>e.prompt),outputs:[],top_neurons:[],token_latents:[],status:"failed",error:t instanceof Error?t.message:String(t),settings:{saveTopTexts:D,trackTexts:H,returnTokenLatents:B,conceptConfigPath:X||void 0,topK:U}}),C(k+1)}finally{_(!1)}}},em=async()=>{s&&I&&d&&await en(s,I)},ep=async()=>{s&&I&&d&&await er(s,I,e=>{G(e),eo()})},eh=a.jsx(x,{history:T,onSelectHistory:E,selectedHistoryEntry:$,onCloseHistoryModal:()=>E(null),settings:{loadConcepts:V,saveTopTexts:D,trackTexts:H},onSettingsChange:e=>{W(e.loadConcepts),F(e.saveTopTexts),J(e.trackTexts)}}),eu=(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(c.p,{step:1,title:"Load model",description:"Choose which model to use for inference. This must be loaded before running inference.",children:[(0,a.jsxs)(o.X2,{children:[(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx(o.__,{children:"Model"}),a.jsx("select",{className:"input",value:s,onChange:e=>{t(e.target.value),j(!1),Z("")},children:e?.map(e=>a.jsxs("option",{value:e.id,children:[e.name," [",e.id,"]"]},e.id))})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx(o.__,{children:"\xa0"}),a.jsx(o.zx,{onClick:ed,disabled:!s||d||b,children:b?(0,a.jsxs)("span",{className:"flex items-center gap-2",children:[a.jsx(o.$j,{})," Loading..."]}):d?"Model loaded":"Load model"})]})]}),v&&a.jsx("p",{className:"text-sm text-slate-600",children:v})]}),a.jsx(c.p,{step:2,title:"Configure inference",description:"Select SAE, layer, and set up prompts and options for inference.",children:a.jsx(u,{...P,saes:g,currentSae:ec,disabled:!d})}),V&&s&&I&&d&&a.jsx(c.p,{step:3,title:"Concept manipulation",description:"Select and adjust concepts to manipulate during inference.",children:(0,a.jsxs)("div",{className:"space-y-4",children:[a.jsx(p,{modelId:s,saeId:I,onEditsChange:Y,onBiasChange:es,onPreview:em,onSaveConfig:ep}),et&&a.jsx("pre",{className:"text-xs bg-slate-900 border border-slate-800 rounded p-2 whitespace-pre-wrap text-slate-100",children:et}),ea&&a.jsx("p",{className:"text-sm text-slate-600",children:ea}),el?.configs&&el.configs.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(o.__,{children:"Concept Configs"}),a.jsx("div",{className:"space-y-2 text-sm",children:el.configs.map(e=>(0,a.jsxs)("div",{className:"border border-slate-200 rounded-md p-2",children:[a.jsx("div",{className:"font-semibold text-slate-900",children:e.name}),(0,a.jsxs)("div",{className:"text-slate-500 text-xs",children:["path: ",e.path]}),a.jsx(o.zx,{variant:"ghost",className:"mt-2 text-xs",onClick:()=>G(e.path),children:"Use this config"})]},e.path))})]})]})}),a.jsx(c.p,{step:V&&s&&I&&d?4:3,title:"Set prompts and run",description:"Enter prompts to run inference on and execute the inference.",children:a.jsx(h,{...P,disabled:!d,onRun:ex,isRunning:y})})]});return(0,a.jsxs)("div",{className:"space-y-6",children:[a.jsx(c.N,{title:"Inference",description:"Run inference with SAEs, manipulate concepts, and view results.",steps:eu,sidebar:eh}),w.length>0&&(0,a.jsxs)("div",{className:"space-y-4",children:[a.jsx(o.NZ,{children:"Inference Runs"}),w.map((e,s)=>a.jsx(m,{runNumber:w.length-s,timestamp:e.timestamp,config:e.config,outputs:e.outputs,top_neurons:e.top_neurons,token_latents:e.token_latents,top_texts_path:e.top_texts_path,onDelete:()=>{S(w.filter(s=>s.id!==e.id))}},e.id))]})]})}},3871:(e,s,t)=>{"use strict";t.d(s,{N:()=>r,p:()=>i});var a=t(326),n=t(830);function r({title:e,description:s,steps:t,sidebar:r}){return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx(n.NZ,{children:e}),s&&a.jsx("p",{className:"text-sm text-slate-500 mt-1",children:s})]}),(0,a.jsxs)("div",{className:"grid gap-2 lg:grid-cols-[minmax(260px,0.9fr)_minmax(0,1.6fr)] items-start",children:[r&&a.jsx(n.Zb,{className:"h-full space-y-2",children:r}),a.jsx(n.Zb,{className:"space-y-4",children:t})]})]})}function i({step:e,title:s,description:t,children:r}){return(0,a.jsxs)(n.Zb,{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"text-xs font-semibold uppercase tracking-wide text-amber-600",children:["Step ",e," - ",s]}),t&&a.jsx("p",{className:"text-xs text-slate-500",children:t})]}),r]})}},830:(e,s,t)=>{"use strict";t.d(s,{$j:()=>p,II:()=>i,Kx:()=>l,NZ:()=>m,X2:()=>d,Zb:()=>r,__:()=>c,u_:()=>x,zx:()=>o});var a=t(326);t(7577);var n=t(1135);function r({children:e,className:s}){return a.jsx("div",{className:(0,n.Z)("card",s),children:e})}function i(e){return a.jsx("input",{...e,className:(0,n.Z)("input",e.className)})}function l(e){return a.jsx("textarea",{...e,className:(0,n.Z)("input","min-h-[120px]",e.className)})}function o({children:e,variant:s="primary",className:t,...r}){return a.jsx("button",{...r,className:(0,n.Z)("primary"===s?"btn btn-primary":"btn btn-ghost",t),children:e})}function c({children:e,htmlFor:s}){return a.jsx("label",{htmlFor:s,className:"text-xs font-semibold tracking-wide text-slate-500",children:e})}function d({children:e}){return a.jsx("div",{className:"grid grid-cols-1 gap-3",children:e})}function x({title:e,children:s,onClose:t}){return a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",onClick:e=>{e.target===e.currentTarget&&t()},children:(0,a.jsxs)("div",{className:"w-full max-w-2xl max-h-[90vh] rounded-lg border border-slate-200 bg-white shadow-xl overflow-hidden flex flex-col",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-slate-200 bg-slate-50",children:[a.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:e}),a.jsx("button",{className:"text-slate-500 hover:text-slate-900 p-1 rounded hover:bg-slate-200 transition-colors",onClick:t,type:"button","aria-label":"Close modal",children:a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),a.jsx("div",{className:"overflow-y-auto p-4",children:s})]})})}function m({children:e}){return a.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:e})}function p({className:e}){return(0,a.jsxs)("svg",{className:`animate-spin h-4 w-4 ${e||"text-amber-600"}`,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[a.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),a.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}},2872:(e,s,t)=>{"use strict";t.d(s,{h:()=>m});class a extends Error{constructor(e,s,t){super(e),this.statusCode=s,this.response=t,this.name="ApiError",Object.setPrototypeOf(this,a.prototype)}}class n extends a{constructor(e="Network request failed"){super(e),this.name="NetworkError",Object.setPrototypeOf(this,n.prototype)}}class r extends a{constructor(e,s){super(e,400,s),this.name="ValidationError",Object.setPrototypeOf(this,r.prototype)}}class i extends a{constructor(e="Resource not found",s){super(e,404,s),this.name="NotFoundError",Object.setPrototypeOf(this,i.prototype)}}class l extends a{constructor(e="Unauthorized",s){super(e,401,s),this.name="UnauthorizedError",Object.setPrototypeOf(this,l.prototype)}}class o extends a{constructor(e="Internal server error",s){super(e,500,s),this.name="ServerError",Object.setPrototypeOf(this,o.prototype)}}let c=process.env.NEXT_PUBLIC_API_BASE||"http://localhost:8000",d=()=>({"Content-Type":"application/json"});async function x(e,s={}){try{let t=await fetch(`${c}${e}`,{...s,headers:{...d(),...s.headers||{}}});if(!t.ok){let e="",s=null;try{s=await t.json(),e="object"==typeof s&&null!==s&&"detail"in s?String(s.detail):JSON.stringify(s)}catch{e=t.statusText||`Request failed with status ${t.status}`}switch(t.status){case 400:throw new r(e||"Validation error",s);case 401:throw new l(e||"Unauthorized",s);case 404:throw new i(e||"Resource not found",s);default:throw new o(e||`Server error: ${t.status}`,s)}}if(204===t.status)return{};return await t.json()}catch(e){if(e instanceof a)throw e;if(e instanceof TypeError&&e.message.includes("fetch"))throw new n("Network request failed");throw new a(e instanceof Error?e.message:"Unknown error occurred")}}let m={models:()=>x("/models"),loadModel:e=>x("/models/load",{method:"POST",body:JSON.stringify({model_id:e})}),layers:e=>x(`/models/${e}/layers`),saveActivations:e=>x("/sae/activations/save",{method:"POST",body:JSON.stringify(e)}),listActivations:e=>x(`/sae/activations?model_id=${e}`),train:e=>x("/sae/train",{method:"POST",body:JSON.stringify(e)}),trainStatus:e=>x(`/sae/train/status/${e}`),cancelTrain:e=>x(`/sae/train/cancel/${e}`,{method:"POST"}),listSaes:e=>x(`/sae/saes?model_id=${e}`),getSaeMetadata:(e,s)=>x(`/sae/saes/${s}/metadata?model_id=${e}`),infer:e=>x("/sae/infer",{method:"POST",body:JSON.stringify(e)}),listConcepts:(e,s)=>x(`/sae/concepts?model_id=${e}${s?`&sae_id=${s}`:""}`),getConceptDictionary:(e,s)=>x(`/sae/concepts/dictionary?model_id=${e}${s?`&sae_id=${s}`:""}`),listConceptConfigs:(e,s)=>x(`/sae/concepts/configs?model_id=${e}${s?`&sae_id=${s}`:""}`),loadConcept:e=>x("/sae/concepts/load",{method:"POST",body:JSON.stringify(e)}),previewConcept:e=>x("/sae/concepts/preview",{method:"POST",body:JSON.stringify(e)}),manipulateConcept:e=>x("/sae/concepts/manipulate",{method:"POST",body:JSON.stringify(e)}),deleteActivation:(e,s)=>x(`/sae/activations/${s}?model_id=${e}`,{method:"DELETE"}),deleteSae:(e,s)=>x(`/sae/saes/${s}?model_id=${e}`,{method:"DELETE"}),health:()=>x("/health/metrics"),storeInfo:()=>x("/store/info"),setStorePath:e=>x("/store/path",{method:"POST",body:JSON.stringify({artifact_base_path:e})}),saeClasses:()=>x("/sae/classes"),getLayerSize:(e,s)=>x(`/sae/train/layer-size?activations_path=${encodeURIComponent(e)}&layer=${encodeURIComponent(s)}`)}},6913:(e,s,t)=>{"use strict";t.d(s,{B:()=>i});var a=t(7577),n=t(8561),r=t(2872);function i(){let{data:e}=(0,n.ZP)("/models",r.h.models),[s,t]=(0,a.useState)(""),[i,l]=(0,a.useState)(!1),[o,c]=(0,a.useState)(!1),d=async()=>{if(s){c(!0);try{await r.h.loadModel(s),l(!0)}finally{c(!1)}}};return{models:e,modelId:s,setModelId:t,modelLoaded:i,setModelLoaded:l,loadModel:d,isLoading:o}}},270:(e,s,t)=>{"use strict";t.r(s),t.d(s,{$$typeof:()=>i,__esModule:()=>r,default:()=>l});var a=t(8570);let n=(0,a.createProxy)(String.raw`/Users/adam/Projects/Inzynierka/codebase/src/frontend/src/app/inference/page.tsx`),{__esModule:r,$$typeof:i}=n;n.default;let l=(0,a.createProxy)(String.raw`/Users/adam/Projects/Inzynierka/codebase/src/frontend/src/app/inference/page.tsx#default`)},2029:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>i});var a=t(9510);t(5023);var n=t(7371);let r=[{href:"/",label:"Home"},{href:"/activations",label:"Activations"},{href:"/training",label:"Training"},{href:"/inference",label:"Inference"}];function i({children:e}){return a.jsx("html",{lang:"en",children:(0,a.jsxs)("body",{className:"min-h-screen bg-amber-50 text-slate-900",children:[a.jsx("div",{className:"border-b border-amber-100 bg-white/80 backdrop-blur",children:(0,a.jsxs)("div",{className:"mx-auto flex max-w-6xl items-center justify-between px-4 py-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-xl bg-amber-400 text-slate-900 font-bold shadow-sm",children:"A"}),(0,a.jsxs)("div",{children:[a.jsx("div",{className:"text-lg font-semibold text-slate-900 tracking-tight",children:"Amber SAE Studio"}),a.jsx("div",{className:"text-xs text-slate-500",children:"Train SAEs, inspect activations, and play with concepts."})]})]}),a.jsx("nav",{className:"flex gap-1 text-sm",children:r.map(e=>a.jsx(n.default,{href:e.href,className:"rounded-full px-3 py-1 text-slate-600 hover:text-slate-900 hover:bg-amber-100 transition",children:e.label},e.href))})]})}),a.jsx("main",{className:"mx-auto max-w-6xl px-4 py-6",children:e})]})})}},5023:()=>{}};var s=require("../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[991,443],()=>t(7181));module.exports=a})();