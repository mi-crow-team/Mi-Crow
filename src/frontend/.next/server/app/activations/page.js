(()=>{var e={};e.id=186,e.ids=[186],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},76:(e,s,a)=>{"use strict";a.r(s),a.d(s,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>o,routeModule:()=>p,tree:()=>c}),a(1194),a(2029),a(5866);var t=a(3191),l=a(8716),n=a(7922),i=a.n(n),r=a(5231),d={};for(let e in r)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>r[e]);a.d(s,d);let c=["",{children:["activations",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,1194)),"/Users/adam/Projects/Inzynierka/codebase/src/frontend/src/app/activations/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,2029)),"/Users/adam/Projects/Inzynierka/codebase/src/frontend/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,5866,23)),"next/dist/client/components/not-found-error"]}],o=["/Users/adam/Projects/Inzynierka/codebase/src/frontend/src/app/activations/page.tsx"],x="/activations/page",m={require:a,loadChunk:()=>Promise.resolve()},p=new t.AppPageRouteModule({definition:{kind:l.x.APP_PAGE,page:"/activations/page",pathname:"/activations",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},1593:(e,s,a)=>{Promise.resolve().then(a.bind(a,8436))},8436:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>x});var t=a(326),l=a(7577),n=a(8561),i=a(2872),r=a(6913),d=a(830),c=a(3871),o=a(3115);function x(){let{models:e,modelId:s,setModelId:a,modelLoaded:x,setModelLoaded:m,loadModel:p,isLoading:h}=(0,r.B)(),{data:u}=(0,n.ZP)(s&&x?`/models/${s}/layers`:null,()=>i.h.layers(s)),{data:j,mutate:v}=(0,n.ZP)(s&&x?`/sae/activations?model_id=${s}`:null,()=>i.h.listActivations(s)),{data:y}=(0,n.ZP)("/store/info",i.h.storeInfo),[_,f]=(0,l.useState)("local"),[N,g]=(0,l.useState)("ag_news"),[b,S]=(0,l.useState)("train"),[k,P]=(0,l.useState)("text"),C=[{id:"ag_news:text",name:"ag_news (text, train)",value:{name:"ag_news",split:"train",field:"text"}},{id:"roneneldan/TinyStories:text",name:"TinyStories (text, train)",value:{name:"roneneldan/TinyStories",split:"train",field:"text"}},{id:"imdb:text",name:"imdb (text, train)",value:{name:"imdb",split:"train",field:"text"}},{id:"yelp_review_full:text",name:"yelp_review_full (text, train)",value:{name:"yelp_review_full",split:"train",field:"text"}},{id:"c4:train",name:"c4 (text, en, train)",value:{name:"c4",split:"train",field:"text"}}],[I,w]=(0,l.useState)("/path/to/file.txt"),[A,$]=(0,l.useState)([]),[z,M]=(0,l.useState)(4),[L,q]=(0,l.useState)(64),[D,E]=(0,l.useState)(),[T,F]=(0,l.useState)(""),[U,G]=(0,l.useState)(!1),[X,B]=(0,l.useState)(null),[H,O]=(0,l.useState)(null),[R,Z]=(0,l.useState)(!1),V=async()=>{if(s&&x&&!U){G(!0),F("Submitting activation run...");try{let e=`${s}-pending`,a="hf"===_?{model_id:s,layers:A,dataset:{type:"hf",name:N,split:b,text_field:k},batch_size:z,shard_size:L,sample_limit:D,run_id:e}:{model_id:s,layers:A,dataset:{type:"local",paths:I.split(",").map(e=>e.trim())},batch_size:z,shard_size:L,sample_limit:D,run_id:e},t={model_id:s,run_id:e,layers:A,dataset:"hf"===_?{type:"hf",name:N,split:b,text_field:k}:{type:"local",paths:I.split(",").map(e=>e.trim())},samples:void 0,tokens:void 0,status:"running"};v(a=>{let l=a?.runs??[];return l.find(s=>s.run_id===e)?a:{...a||{model_id:s,runs:[]},runs:[t,...l]}},!1);let l=await i.h.saveActivations(a);F(`Saved. run_id=${l.run_id}, samples=${l.samples}, tokens=${l.tokens}`),v(s=>s?{...s,runs:(s.runs??[]).map(s=>s.run_id===e?{...s,samples:l.samples??s.samples,tokens:l.tokens??s.tokens,manifest_path:l.manifest_path??s.manifest_path,status:l.status??"done",created_at:l.created_at??s.created_at,layers:Array.isArray(l.layers)&&l.layers.length?l.layers:s.layers,dataset:l.dataset??s.dataset}:s)}:s,!1),v()}catch(s){let e=s instanceof Error?s.message:String(s);F(`Error: ${e}`)}finally{G(!1)}}},J=[];j&&Array.isArray(j.runs)?J=j.runs:s&&y&&y.activation_datasets&&Array.isArray(y.activation_datasets[s])&&(J=y.activation_datasets[s]),J=[...J].sort((e,s)=>{let a=e.created_at&&!Number.isNaN(Date.parse(e.created_at))?Date.parse(e.created_at):0,t=s.created_at&&!Number.isNaN(Date.parse(s.created_at))?Date.parse(s.created_at):0;return a!==t?t-a:(s.run_id||"").localeCompare(e.run_id||"")}),(0,l.useMemo)(()=>J.length>0,[J]);let K=[t.jsx(c.p,{step:1,title:"Load model",description:"Pick a language model and load it into memory. Other steps will unlock afterwards.",children:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[t.jsx(d.__,{children:"Model"}),t.jsx("select",{className:"input",value:s,onChange:e=>{a(e.target.value),m(!1),$([])},children:e?.map(e=>t.jsxs("option",{value:e.id,children:[e.name," [",e.id,"] (",e.status,")"]},e.id))})]}),t.jsx("div",{children:t.jsx(d.zx,{onClick:async()=>{if(s){F("Loading model...");try{await p(),F("Model loaded")}catch(s){let e=s instanceof Error?s.message:String(s);F(`Error loading model: ${e}`)}}},disabled:!s||x||h,children:h?(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[t.jsx(d.$j,{})," Loading..."]}):x?"Model loaded":"Load model"})})]})}),t.jsx(c.p,{step:2,title:"Choose layers, dataset and save activations",description:"Select which layers to capture, choose a dataset, and launch an activation capture run.",children:(0,t.jsxs)("div",{className:`space-y-5 ${x?"":"opacity-50 pointer-events-none"}`,children:[t.jsx(d.X2,{children:(0,t.jsxs)("div",{className:"space-y-1",children:[t.jsx(d.__,{children:"Layers"}),t.jsx("select",{multiple:!0,className:"input h-28",value:A,onChange:e=>$(Array.from(e.target.selectedOptions).map(e=>e.value)),children:u?.map(e=>t.jsx("option",{value:e.layer_id,children:e.name},e.layer_id))}),t.jsx("p",{className:"text-xs text-slate-500",children:"Cmd/Ctrl+click to multi-select."})]})}),(0,t.jsxs)("div",{className:"space-y-4 text-sm",children:[(0,t.jsxs)("div",{className:"flex gap-3",children:[t.jsx("button",{className:`px-3 py-1 rounded-md border ${"hf"===_?"border-sky-500 text-sky-300":"border-slate-700"}`,onClick:()=>f("hf"),children:"HF dataset"}),t.jsx("button",{className:`px-3 py-1 rounded-md border ${"local"===_?"border-sky-500 text-sky-300":"border-slate-700"}`,onClick:()=>f("local"),children:"Local files"})]}),y&&s&&y.activation_datasets?.[s]?.length?(0,t.jsxs)("div",{className:"space-y-1",children:[t.jsx(d.__,{children:"Previously used datasets for this model"}),(0,t.jsxs)("select",{className:"input",onChange:e=>{let a=e.target.value,t=y.activation_datasets[s].find(e=>e.run_id===a);if(!t)return;let l=t.dataset||{},n="hf"===l.type?"hf":"local";f(n),"hf"===n?(g(l.name||""),S(l.split||"train"),P(l.text_field||"text")):"local"===n&&w((Array.isArray(l.paths)?l.paths.join(", "):"")||"")},defaultValue:"",children:[t.jsx("option",{value:"",disabled:!0,children:"Select a previous run to reuse its dataset"}),y.activation_datasets[s].map(e=>(0,t.jsxs)("option",{value:e.run_id,children:[e.run_id," (",e.dataset?.type==="hf"?e.dataset.name:"local",")"]},e.run_id))]}),t.jsx("p",{className:"text-xs text-slate-500",children:"Selecting a run will pre-fill the dataset fields below based on its manifest."})]}):null,"hf"===_?(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[t.jsx(d.__,{children:"Preset HF datasets"}),(0,t.jsxs)("select",{className:"input",defaultValue:"",onChange:e=>{let s=C.find(s=>s.id===e.target.value);s&&(g(s.value.name),S(s.value.split),P(s.value.field))},children:[t.jsx("option",{value:"",children:"Custom / manual"}),C.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]}),t.jsx("p",{className:"text-xs text-slate-500",children:'Choose a preset or leave on "Custom" to fill in fields manually.'})]}),(0,t.jsxs)(d.X2,{children:[(0,t.jsxs)("div",{className:"space-y-1",children:[t.jsx(d.__,{children:"HF name"}),t.jsx(d.II,{value:N,onChange:e=>g(e.target.value)})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[t.jsx(d.__,{children:"Split"}),t.jsx(d.II,{value:b,onChange:e=>S(e.target.value)})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[t.jsx(d.__,{children:"Text field"}),t.jsx(d.II,{value:k,onChange:e=>P(e.target.value)})]})]})]}):(0,t.jsxs)("div",{className:"space-y-1",children:[t.jsx(d.__,{children:"Local paths (comma-separated)"}),t.jsx(d.II,{value:I,onChange:e=>w(e.target.value)})]})]}),(0,t.jsxs)(d.X2,{children:[(0,t.jsxs)("div",{className:"space-y-1",children:[t.jsx(d.__,{children:"Batch size"}),t.jsx(d.II,{type:"number",value:z,onChange:e=>M(Number(e.target.value)),min:1})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[t.jsx(d.__,{children:"Shard size"}),t.jsx(d.II,{type:"number",value:L,onChange:e=>q(Number(e.target.value)),min:1})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[t.jsx(d.__,{children:"Sample limit (optional)"}),t.jsx(d.II,{type:"number",value:D??"",onChange:e=>E(e.target.value?Number(e.target.value):void 0),min:1})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[t.jsx(d.zx,{onClick:V,disabled:!x||U,children:U?(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[t.jsx(d.$j,{})," Saving activations..."]}):"Save activations"}),T&&t.jsx("p",{className:"text-sm text-slate-300",children:T})]})]})})],Q=t.jsx(o.P,{title:"Activation runs",items:J,emptyMessage:"No activation runs yet for this model.",renderItem:e=>{let s=!e.samples&&!e.tokens,a=e.created_at&&!Number.isNaN(Date.parse(e.created_at))?new Date(e.created_at).toLocaleString():"-",l=s?"in progress":e.status??"done",n="done"===l||"completed"===l;return(0,t.jsxs)("button",{type:"button",onClick:()=>{O(e),Z(!0)},className:"w-full text-left",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[t.jsx("div",{className:"font-semibold text-slate-900 truncate",title:e.run_id,children:e.run_id}),t.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${n?"bg-green-100 text-green-700":"bg-amber-100 text-amber-700"}`,children:n?"✓ Done":"⏳ In Progress"})]}),(0,t.jsxs)("div",{className:"space-y-1 text-xs",children:[(0,t.jsxs)("div",{className:"text-slate-700",children:[t.jsx("span",{className:"text-slate-600",children:"Started:"})," ",t.jsx("span",{className:"text-slate-900",children:a})]}),(0,t.jsxs)("div",{className:"text-slate-700",children:[t.jsx("span",{className:"text-slate-600",children:"Layers:"})," ",t.jsx("span",{className:"text-slate-900",children:e.layers?.length?e.layers.join(", "):"-"})]}),(0,t.jsxs)("div",{className:"text-slate-700",children:[t.jsx("span",{className:"text-slate-600",children:"Samples:"})," ",t.jsx("span",{className:"text-slate-900",children:e.samples??"-"})," | ",t.jsx("span",{className:"text-slate-600",children:"Tokens:"})," ",t.jsx("span",{className:"text-slate-900",children:e.tokens??"-"})]}),e.dataset&&(0,t.jsxs)("div",{className:"text-slate-700",children:[t.jsx("span",{className:"text-slate-600",children:"Dataset:"})," ",t.jsx("span",{className:"text-slate-900",children:"hf"===e.dataset.type?e.dataset.name??"hf":"local"===e.dataset.type?"local files":e.dataset.type??"unknown"})]})]})]})}});return(0,t.jsxs)(t.Fragment,{children:[t.jsx(c.N,{title:"Capture Activations",description:"Save model activations to disk for later SAE training.",steps:K,sidebar:Q}),R&&H&&t.jsx(d.u_,{title:`Activation Run - ${H.run_id}`,onClose:()=>{Z(!1),O(null)},children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between pb-2 border-b border-slate-200",children:[t.jsx("h3",{className:"font-semibold text-slate-900",children:"Basic Information"}),t.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${"done"===H.status||"completed"===H.status||H.samples?"bg-green-100 text-green-700 border border-green-300":"bg-amber-100 text-amber-700 border border-amber-300"}`,children:"done"===H.status||"completed"===H.status||H.samples?"✓ Completed":"⏳ In Progress"})]}),t.jsx("div",{className:"space-y-2",children:(0,t.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,t.jsxs)("div",{children:[t.jsx("span",{className:"text-slate-600",children:"Model:"})," ",t.jsx("span",{className:"text-slate-900 font-mono",children:H.model_id})]}),(0,t.jsxs)("div",{children:[t.jsx("span",{className:"text-slate-600",children:"Run ID:"})," ",t.jsx("span",{className:"text-slate-900 font-mono",children:H.run_id})]}),H.created_at&&(0,t.jsxs)("div",{children:[t.jsx("span",{className:"text-slate-600",children:"Created:"})," ",t.jsx("span",{className:"text-slate-900",children:new Date(H.created_at).toLocaleString()})]}),(0,t.jsxs)("div",{children:[t.jsx("span",{className:"text-slate-600",children:"Layers:"})," ",t.jsx("span",{className:"text-slate-900",children:H.layers?.length?H.layers.join(", "):"-"})]}),(0,t.jsxs)("div",{children:[t.jsx("span",{className:"text-slate-600",children:"Samples:"})," ",t.jsx("span",{className:"text-slate-900",children:H.samples??"-"})," |"," ",t.jsx("span",{className:"text-slate-600",children:"Tokens:"})," ",t.jsx("span",{className:"text-slate-900",children:H.tokens??"-"})]})]})}),H.dataset&&(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx("h3",{className:"font-semibold text-slate-900",children:"Dataset"}),(0,t.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,t.jsxs)("div",{children:[t.jsx("span",{className:"text-slate-600",children:"Type:"})," ",t.jsx("span",{className:"text-slate-900",children:H.dataset.type??"unknown"})]}),"hf"===H.dataset.type&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{children:[t.jsx("span",{className:"text-slate-600",children:"Name:"})," ",t.jsx("span",{className:"text-slate-900",children:H.dataset.name??"-"})]}),(0,t.jsxs)("div",{children:[t.jsx("span",{className:"text-slate-600",children:"Split:"})," ",t.jsx("span",{className:"text-slate-900",children:H.dataset.split??"-"})]}),(0,t.jsxs)("div",{children:[t.jsx("span",{className:"text-slate-600",children:"Text field:"})," ",t.jsx("span",{className:"text-slate-900",children:H.dataset.text_field??"-"})]})]}),"local"===H.dataset.type&&(0,t.jsxs)("div",{children:[t.jsx("span",{className:"text-slate-600",children:"Paths:"}),t.jsx("div",{className:"mt-1 space-y-1",children:Array.isArray(H.dataset.paths)?H.dataset.paths.map((e,s)=>t.jsx("div",{className:"text-slate-900 bg-slate-50 border border-slate-200 p-2 rounded text-xs font-mono break-all",children:e},s)):t.jsx("span",{className:"text-slate-900",children:"-"})})]})]})]}),H.manifest_path&&(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx("h3",{className:"font-semibold text-slate-900",children:"Manifest"}),(0,t.jsxs)("div",{className:"text-sm",children:[t.jsx("span",{className:"text-slate-600",children:"Manifest Path:"}),t.jsx("div",{className:"text-slate-900 font-mono text-xs mt-1 break-all bg-slate-50 border border-slate-200 p-2 rounded",children:H.manifest_path})]})]})]})})]})}},1194:(e,s,a)=>{"use strict";a.r(s),a.d(s,{$$typeof:()=>i,__esModule:()=>n,default:()=>r});var t=a(8570);let l=(0,t.createProxy)(String.raw`/Users/adam/Projects/Inzynierka/codebase/src/frontend/src/app/activations/page.tsx`),{__esModule:n,$$typeof:i}=l;l.default;let r=(0,t.createProxy)(String.raw`/Users/adam/Projects/Inzynierka/codebase/src/frontend/src/app/activations/page.tsx#default`)}};var s=require("../../webpack-runtime.js");s.C(e);var a=e=>s(s.s=e),t=s.X(0,[991,443,623],()=>a(76));module.exports=t})();